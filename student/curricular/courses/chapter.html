<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="../../bootstrap/css/bootstrap-theme.min.css">
    <script src="../../js/vue.min.js"></script>
    <script src="../../js/axios.min.js"></script>
    <script src="../static/jquery/2.2.4/jquery.min.js"></script>
    <script type="text/javascript" src="ckplayer/ckplayer.js"></script>
    <script src="../../js/elementui/index.js"></script>
    <link rel="stylesheet" href="../../js/elementui/index.css">
    <style>
        .chapter-top .el-collapse-item__header{
            background-color: rgb(232,249,255);
        }
    </style>
</head>
<body>
<div id="app">

   <el-row type="flex" justify="center">
       <el-col :span="2">
           <el-button icon="el-icon-refresh" type="primary" onclick=" window.location.reload();">刷新</el-button>
       </el-col>
   </el-row>
    <el-row>
        <el-collapse>
            <el-collapse-item class="chapter-top"  v-for="(item,i) in chapterData" :title="item.chaName">

            </el-collapse-item>
        </el-collapse>
    </el-row>
</div>
<script type="text/javascript">
    axios.defaults.headers.common['Authorization'] = "bearer " + sessionStorage.getItem("access_token");
    window.onbeforeunload = function (e) {
      /*  console.log("sss离开", e)
        console.log("sss离开", app.hiy)*/
        //app.addStudy(app.hiy);
    }


    var app = new Vue({
        el: "#app",
        data: {
            //章节数据
            chapterData:[],
            sid:'',
            cid:'',
            //视频进度
            hiy: 0,
            //播放器
            player: null,
        },
        methods: {
            timeHandler(t) {
                this.hiy = t;
            },
            //查询课程下所有章节
            queryChapter() {
                axios({
                    method: 'get',
                    url: `/api/student/study/queryChapter`,
                    params: {
                        cid: this.cid
                    }
                }).then(res => {
                    this.chapterData = res.data;

                })
            },
            bofang(url, type, chaId) {
                this.starttime = new Date();//点击播放按钮时获取当前时间（未完成）
                console.log("this.starttime=>" + this.starttime);
                var videoObject = {
                    container: '#video',//“#”代表容器的ID，“.”或“”代表容器的class
                    variable: 'player',//该属性必需设置，值等于下面的new chplayer()的对象
                    flashplayer: false,//如果强制使用flashplayer则设置成true
                    video: url,//视频地址
                    //loaded:'loadHandler',//监听事件
                };
                this.player = new ckplayer(videoObject);
                this.player.addListener('time', app.timeHandler); //监听播放时间

            },
            addStudy(time) {
                //chaId章节Id
                //starttime 备注:学习开始的时间
                //watchtime 观看视频时常
                //credits 学分
                var courId = sessionStorage.getItem("courId");//课程id
                let params = new URLSearchParams()
                params.append('cid', courId);
                params.append('chaid', this.chaId);
                params.append('watchtime', time);
                params.append('sid', sessionStorage.getItem("userid"));
                axios({
                    method: 'post',
                    url: `/api/student/study/addChapterStudyLog`,
                    data: params,
                }).then(res => {

                })
            },
        },
        mounted() {
            this.sid = sessionStorage.getItem("userid");
            this.cid = sessionStorage.getItem("courId");
            this.queryChapter();
        },

    })
</script>
</body>
</html>