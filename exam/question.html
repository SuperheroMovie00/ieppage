<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>question 题库管理</title>
    <link rel="stylesheet" type="text/css" href="css/iview.css">
    <script src="js/vue.min.js"></script>
    <script src="js/iview.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/index.css"/>
    <script src="js/index.js"></script>
    <script src="js/axios.js"></script>


</head>
<body>

<!--<h1 align="center">题库管理</h1>
<br>
<hr>
<br><br><br>-->


<div id="app" align="center">
    <div align="center">

        <!--条件查询的条件输入框-->
        <el-button type="primary" icon="el-icon-plus" @click="dialogVisibletype = true" size="small" round>新增试题
        </el-button>
        <font size="4">题干:</font>
        <el-input v-model="rubric" placeholder="请输入内容" style="width: 150px;" size="small"></el-input>
        <font size="4">试题的类型:</font>
        <el-select v-model="typecc" placeholder="请选择" size="small">
            <el-option v-for="item in options2" :key="item.value" :label="item.label" :value="item.value"
                       :disabled="item.disabled">
            </el-option>
        </el-select>
        <font size="4">课程:</font>
        <el-input v-model="course" placeholder="请输入内容" style="width: 120px;" size="small"></el-input>
        <font size="4">章节:</font>
        <el-input v-model="section" placeholder="请输入内容" style="width: 120px;" size="small"></el-input>

        <el-button type="primary" icon="el-icon-search" @click="query()" v-on:keyup.13="submit" size="small" round>搜索
        </el-button>
    </div>


    <el-dialog title="选择新增题型" :visible.sync="dialogVisibletype" width="60%" :before-close="handleClose">
        <el-button type="primary" icon="el-icon-plus" @click="dialogVisible = true" size="small" round>新增选择题
        </el-button>
        <el-button type="primary" icon="el-icon-plus" @click="dialogVisible = true" size="small" round>新增试题
        </el-button>
        <el-button type="primary" icon="el-icon-plus" @click="dialogVisible = true" size="small" round>新增试题
        </el-button>
    </el-dialog>


    <div style="width: 100%;">
        <template>
            <!--element表格-->
            <el-table :data="rubricList" style=" width: auto">
                <!--<el-table-column prop="id" label="序号" :show-overflow-tooltip="true">
                </el-table-column>-->
                <el-table-column prop="rubricttype" label="试题类型" :show-overflow-tooltip="true">
                </el-table-column>
                <el-table-column prop="content" label="题干" :show-overflow-tooltip="true">
                </el-table-column>
                <el-table-column prop="A" label="选项A" :show-overflow-tooltip="true">
                </el-table-column>
                <el-table-column prop="B" label="选项B" :show-overflow-tooltip="true">
                </el-table-column>
                <el-table-column prop="C" label="选项C" :show-overflow-tooltip="true">
                </el-table-column>
                <el-table-column prop="D" label="选项D" :show-overflow-tooltip="true">
                </el-table-column>
                <el-table-column prop="sectionId" label="章节id" :show-overflow-tooltip="true">
                </el-table-column>
                <el-table-column prop="courseId" label="课程id" :show-overflow-tooltip="true">
                </el-table-column>
                <el-table-column prop="answerId" label="答案id" :show-overflow-tooltip="true">
                </el-table-column>

                <el-table-column prop="operation" label="操作" align="center" min-width="100">
                    <template slot-scope="scope">
                        <el-button type="primary" round @click="checkDetail(scope.row)" size="mini">查看
                        </el-button>
                        <el-button type="danger" round @click="deleterubric(scope.row)" size="mini">删除
                        </el-button>
                    </template>
                </el-table-column>
            </el-table>

        </template>
    </div>

    <!--新增试题对话框-->
    <el-dialog title="新增试题" :visible.sync="dialogVisible" width="60%" :before-close="handleClose">

        <el-form ref="form" :model="form" label-width="80px">
            <el-form-item label="题干内容:">
                <el-input v-model="addrubric"></el-input>
            </el-form-item>

            <el-form-item label="试题类型:">
                <el-select v-model="rubrictype1" placeholder="请选择" size="small">
                    <el-option v-for="item in options2" :key="item.value" :label="item.label" :value="item.value"
                               :disabled="item.disabled">
                    </el-option>
                </el-select>
            </el-form-item>

            <el-form-item label="答案A:">
                <el-input v-model="answerA" style="width:80%"></el-input>
                <el-switch v-model="form" active-value="A" inactive-value=""></el-switch>
            </el-form-item>

            <el-form-item label="答案B">
                <el-input v-model="answerB" style="width:80%"></el-input>
                <el-switch v-model="form" active-value="B" inactive-value=""></el-switch>
            </el-form-item>

            <el-form-item label="答案C">
                <el-input v-model="answerC" style="width:80%"></el-input>
                <el-switch v-model="form" active-value="C" inactive-value=""></el-switch>
            </el-form-item>

            <el-form-item label="答案D">
                <el-input v-model="answerD" style="width:80%"></el-input>
                <el-switch v-model="form" active-value="D" inactive-value=""></el-switch>
            </el-form-item>


            <el-form-item>
                <el-button type="primary" @click="addrudic()">立即创建</el-button>
                <el-button @click="addquxiao()">取消</el-button>
            </el-form-item>
        </el-form>

    </el-dialog>


    <!--修改填空题的对话框-->
    <el-dialog title="修改填空题" :visible.sync="dialogVisiblepack" width="60%" :before-close="handleClose">

        <el-form ref="form" :model="form" label-width="80px">
            <el-form-item label="题干内容:">
                <el-input v-model="packrubric"></el-input>
            </el-form-item>

            <el-form-item label="正确答案:">
                <el-input v-model="packanswer" style="width:80%"></el-input>
            </el-form-item>


            <el-form-item>
                <el-button type="primary" @click="updaterubric()">保存</el-button>
                <el-button @click="dialogVisiblepack = false">取消</el-button>
            </el-form-item>
        </el-form>


    </el-dialog>


    <!--修改判断题的对话框-->
    <el-dialog title="修改判断题" :visible.sync="dialogVisiblejudge" width="60%" :before-close="handleClose">

        <el-form ref="form" :model="form" label-width="80px">
            <el-form-item label="题干内容:">
                <el-input v-model="judgerubric"></el-input>
            </el-form-item>

            <el-switch v-model="value3" active-text="正确" inactive-text="错误">

            </el-switch>


            <el-form-item>
                <el-button type="primary" @click="updaterubric()">保存</el-button>
                <el-button @click="dialogVisiblejudge = false">取消</el-button>
            </el-form-item>

        </el-form>
    </el-dialog>


    <!--修改选择题的对话框-->
    <el-dialog title="修改选择题" :visible.sync="dialogVisibleselect" width="60%" :before-close="handleClose">
        <el-form ref="updateform" :model="updateform" label-width="80px">
            <el-form-item label="题干内容:">
                <el-input v-model="inputupdate"></el-input>
            </el-form-item>

            <el-form-item label="答案A:">
                <el-input v-model="inputA" style="width:80%"></el-input>
                <el-switch v-model="updateform" active-value="A" inactive-value=""></el-switch>
            </el-form-item>

            <el-form-item label="答案B">
                <el-input v-model="inputB" style="width:80%"></el-input>
                <el-switch v-model="updateform" active-value="B" inactive-value=""></el-switch>
            </el-form-item>

            <el-form-item label="答案C">
                <el-input v-model="inputC" style="width:80%"></el-input>
                <el-switch v-model="updateform" active-value="C" inactive-value=""></el-switch>
            </el-form-item>

            <el-form-item label="答案D">
                <el-input v-model="inputD" style="width:80%"></el-input>
                <el-switch v-model="updateform" active-value="D" inactive-value=""></el-switch>
            </el-form-item>


            <el-form-item>
                <el-button type="primary" @click="updaterubric()">保存</el-button>
                <el-button @click="dialogVisibleselect = false">取消</el-button>
            </el-form-item>
        </el-form>


    </el-dialog>


    <el-pagination class="fy"
                   layout="prev, pager, next"
                   @current-change="current_change"
                   :total="total"
                   :page-size="pagesize"
                   background
    >
    </el-pagination>


</div>
</body>

<script>

    axios.defaults.headers.common['Authorization'] = "bearer " + sessionStorage.getItem("access_token");


    var Main = new Vue({
        el: '#app',

        /*初始化方法放在这里面(相当于页面加载事件)*/
        mounted: function () {

            this.query();
        },

        /*数据*/
        data() {
            return {

                updateform: {
                    inputupdate: '',
                    inputA: '',
                    inputB: '',
                    inputC: '',
                    inputD: '',
                    updateform: true,
                },
                form: {
                    addrubric: '',
                    rubrictype1: '',
                    answerA: "",
                    answerB: "",
                    answerC: "",
                    answerD: "",
                    form: true,
                },


                options2: [
                    {
                        value: '',
                        label: '请选择'
                    },
                    {
                        value: '选择题',
                        label: '选择题'
                    }, {
                        value: '填空题',
                        label: '填空题'
                    }, {
                        value: '判断题',
                        label: '判断题'
                    }],
                value: '',
                user: {},
                dialogVisibleselect: false,
                dialogVisiblejudge: false,
                dialogVisiblepack: false,
                rubric: "",
                typecc: "",
                value3: '',
                course: "",
                section: "",
                dialogVisible: false,
                total: 50,//默认数据总数
                pagesize: 10,//每页的数据条数
                currentPage: 1,//默认开始页面
                rubricList: [],


            };
        },
        /*方法函数写在这里面*/
        methods: {


            /*show: function (ev) {
                if (ev.keyCode == 13) {
                    alert('你按回车键了');
                }
            },*/

            /*点击新增试题时触发*/

            addrudic() {

                let params = new URLSearchParams();
                params.append("rubrictype", this.rubrictype1)
                params.append("answerid", this.form)
                params.append("addrubric", this.addrubric)
                params.append("answerA", this.answerA)
                params.append("answerB", this.answerB)
                params.append("answerC", this.answerC)
                params.append("answerD", this.answerD)
                //判断是否选中正确答案
                if (this.answerD != null && this.answerC != null && this.answerB != null && this.answerA != null && this.addrubric != null && this.rubrictype1 != null) {


                    if (this.form != true) {
                        axios({
                            method: 'post',
                            url: '/api/exam/rubric/addrubric',
                            data: params,

                        }).then(res => {
                            res = res.data;
                            if (res.success) {

                                this.$notify({title: "成功", message: res.message, type: 'success'});
                                this.dialogVisible = false;
                                this.query();


                            } else {
                                this.$notify.error({title: "失败", message: res.message})
                            }


                        })
                    } else {
                        this.$notify.error({title: "失败", message: "请选择正确答案"})
                    }
                }

                else {
                    this.$notify.error({title: "失败", message: "请填写完成试题信息"})
                }


            },
            addquxiao() {

                this.addrubric = '',
                    this.rubrictype1 = '',
                    this.answerA = "",
                    this.answerB = "",
                    this.answerC = "",
                    this.answerD = "",
                    this.form = true,
                    this.dialogVisible = false;
            },


            query() {

                let params = new URLSearchParams();
                params.append("page", this.currentPage)
                params.append("rows", this.pagesize)
                params.append("rubric", this.rubric);
                params.append("type", this.typecc);
                params.append("course", this.course);
                params.append("section", this.section);
                axios({
                    method: 'post',
                    url: '/api/exam/rubric/queryrubricer',
                    data: params,

                }).then(res => {

                    res = res.data;

                    for (let i = 0; i < res.page.length; i++) {
                        let r = res.page[i];
                        let answer = r.answer;
                        for (let j = 0; j < answer.length; j++) {
                            let a = answer[j];
                            r[a.optiones] = a.content;
                            r[a.optiones + "id"] = a.id;
                        }
                    }
                    this.rubricList = res.page;
                    this.total = res.total;


                })

            },
            /*点击查看的时候调用这个*/

            checkDetail(val) {


                this.id = val.id;
                this.answerid = val.answerId;
                this.inputupdate = val.content;
                this.type = val.rubricttype;
                this.inputA = val.A;
                this.inputB = val.B;
                this.inputC = val.C;
                this.inputD = val.D;
                this.aaaa = val.Aid;
                this.bbbb = val.Bid;
                this.cccc = val.Cid;
                this.dddd = val.Did;

                this.list = val;

                if (val.rubricttype == "选择题") {
                    this.dialogVisibleselect = true;

                    if (val.answerId == val.Aid) {
                        window.setTimeout(() => {
                            this.updateform = "A";
                        }, 1)
                    } else if (val.answerId == val.Bid) {
                        window.setTimeout(() => {
                            this.updateform = "B";
                        }, 1)
                    } else if (val.answerId == val.Cid) {
                        window.setTimeout(() => {
                            this.updateform = "C";
                        }, 1)
                    } else if (val.answerId == val.Did) {
                        window.setTimeout(() => {
                            this.updateform = "D";
                        }, 1)
                    }


                } else if (val.rubricttype == "填空题") {


                    this.dialogVisiblepack = true;
                    this.packrubric = val.content;
                    this.packanswer = val.answerId;


                } else if (val.rubricttype == "判断题") {
                    this.judgerubric = val.content

                    if (val.answerId == "正确") {
                        this.value3 = true;
                    } else if (val.answerId == "错误") {
                        this.value3 = false;
                    }
                    this.dialogVisiblejudge = true;

                }


            },

            /*更改试题内容*/
            updaterubric() {
                let params = new URLSearchParams();


                /* params.append("rubrictype", this.)
                 params.append("answerid", this.)*/
                params.append("id", this.id)//要修改的题的id
                params.append("answerid", this.answerid)//答案id(判断题对错,填空题标准答案)
                params.append("rubric", this.inputupdate)//修改的题干
                params.append("answerA", this.inputA)//修改的选项A
                params.append("answerB", this.inputB)//修改的B
                params.append("answerC", this.inputC)
                params.append("answerD", this.inputD)

                params.append("Aid", this.aaaa)//修改的选项A
                params.append("Bid", this.bbbb)//修改的B
                params.append("Cid", this.cccc)
                params.append("Did", this.dddd)

                params.append("xzanswer", this.updateform)//选择正确答案
                params.append("tkanswer", this.packanswer)//填空正确答案
                params.append("pdanswer", this.value3)//判断正确答案
                params.append("type", this.type)//试题类型
                params.append("list", this.list)//修改之前的数据


                axios({
                    method: 'post',
                    url: '/api/exam/rubric/updateredicbyid',
                    data: params,

                }).then(res => {
                    res = res.data;
                    if (res.success) {
                        this.$notify({title: "成功", message: res.message, type: 'success'});
                        this.dialogVisiblejudge = false;
                        this.dialogVisiblepack = false;
                        this.dialogVisibleselect = false;
                        this.query();


                    } else {
                        this.$notify.error({title: "失败", message: res.message})
                    }


                })


            },

            /*删除一个试题*/
            deleterubric(val) {
                let params = new URLSearchParams();
                params.append("id", val.id)
                axios({
                    method: 'post',
                    url: '/api/exam/rubric/deleteredicbyid',
                    data: params,


                }).then(res => {
                    res = res.data;
                    if (res.success) {
                        this.$notify({title: "删除成功", message: res.message, type: 'success'});
                        this.query();

                    } else {
                        alert(res.message);
                        this.$notify.error({title: "失败", message: res.message});
                    }
                })
            },


            handleSizeChange(val) {
                this.pagesize = val;
                console.log(this.pagesize)  //每页下拉显示数据
            },

            handleCurrentChange() {
                this.currentPage = currentPage;
                console.log(this.currentPage)  //点击第几页
            },

            created: function () {
                this.total = this.tableData.length;
            },
            current_change: function (currentPage) {
                this.currentPage = currentPage;
                this.query();
            }


        }

    });

</script>
</body>
</html>
          