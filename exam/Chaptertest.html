<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>章节测验列表</title>
    <link rel="stylesheet" type="text/css" href="css/iview.css">
    <script src="js/vue.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/index.css"/>
    <script src="js/index.js"></script>
    <script src="js/axios.js"></script>
</head>
<body>
<div id="app">

    <el-collapse v-for="(site,index) in Curriculumcollectionlist" >
        <h3>{{site.chaName}}：</h3>
        <span v-for="(chapter,index) in ChaptertestList" v-if="chapter.sectionId==site.chaId" >
        <span  @click="testlog(chapter.id)">

         <el-collapse-item>
            <template slot="title" >
                <h3 >{{chapter.title}}</h3><el-button type="success" style="margin-left: 1000px" size="medium" @click="testzhangjie(chapter.id)">前往测验</el-button>
            </template>
                <el-table
                        :data="tableData"
                        style="width: 800px">
                    <el-table-column
                            label="上一次提交时间"
                          >
                         <template slot-scope="scope">
                <span style="margin-left: 10px">{{ scope.row.endtime }}</span>
                    </template>
                    </el-table-column>
                    <el-table-column
                            label="测验次数">
                         <template slot-scope="scope">
                <span style="margin-left: 10px">{{ scope.row.examnum }}</span>
                    </template>
                    </el-table-column>
                    <el-table-column
                            label="测验最高分">
                            <template slot-scope="scope">
                <span style="margin-left: 10px">{{ scope.row.maxtotal }}</span>
                    </template>
                    </el-table-column>
                </el-table>

        </el-collapse-item>
            </span>
      </span>
    </el-collapse>

</div>
    <script>
        axios.defaults.headers.common['Authorization'] = "bearer " + sessionStorage.getItem("access_token");
        let userid = sessionStorage.getItem("userid");
        new Vue({
            el:"#app",
            data:{
                tableData: [
                ],
                Curriculumcollectionlist:[],//课程章节集合
                ChaptertestList:[]//章节测试集合

            },
            mounted: function () {
                this.quary();

            },
            methods:{
                testzhangjie(chapter){
                    window.location.href = "/exam/ChaptertestTopic.html?chapterId="+chapter;
                },
                quary() {
                    let params = new URLSearchParams();
                    //params.append("studentId", userid);
                    params.append("courseid", "16");
                    axios({
                        method: 'post',
                        url: '/api/exam/sectionparper/selectsectionparperrubricer',
                        data: params,
                    }).then(res => {
                        this.Curriculumcollectionlist = res.data.sectionlist.message;
                        this.ChaptertestList=res.data.parperlist;
                    })
                },
                testlog(chapter){
                   // alert(chapter);
                   let params = new URLSearchParams();
                   params.append("studentid", userid);
                    params.append("parperid", chapter);
                    axios({
                        method: 'post',
                        url: '/api/exam/sectionparper/selecttotalandnumandmaxtotal',
                        data: params,
                    }).then(res => {
                        this.tableData=res.data;
                    })
                }

            }
        })
    </script>

</body>
</html>